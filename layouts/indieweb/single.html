{{ define "main" }}
<main>
	<article class="h-entry">
		<div class="title">
			<!-- indieweb: title ON -->
			{{- if .Params.mfbookmark -}}
				<h1 class="title p-name">‚≠êÔ∏è Bookmarked:<br> <a href="{{ .Params.mfbookmark }}" target="_blank" rel="nofollow noopener noreferrer">{{ .Params.mfbookmark }}</a></h1>
				<a class="u-bookmark-of" href="{{ .Params.mfbookmark }}" style="display:none;">{{ .Params.mfbookmark }}</a>
			{{- else if .Params.mfrepostof -}}
				<h1 class="title p-name">‚ôªÔ∏è Repost:<br> {{ .Params.mfrepostof }}</h1>
				<a class="u-repost-of" href="{{ .Params.mfrepostof }}" style="display:none;">reposted {{ .Params.mfrepostof }}</a>
			{{- else if .Params.mflikeof -}}
				<h1 class="title p-name">üëç Liked:<br> {{ .Params.mflikeof }}</h1>
				<a class="u-url u-like-of" href="{{ .Params.mflikeof }}" style="display:none;">{{ .Params.mflikeof | truncate 45 }}</a>
				{{ if .Params.cite }}
					<blockquote class="e-content" cite="{{ .Params.mflikeof }}"><p>{{ .Params.cite }}</p></blockquote>
				{{ end }}
			{{- else if .Params.mfreplyto -}}
				<h1 class="title p-name">‚Ü©Ô∏è Reply to:<br> {{ .Params.mfreplyto }}</h1>
				<a class="u-in-reply-to" rel="in-reply-to" href="{{ .Params.mfreplyto }}" style="display:none;">{{ .Params.mfreplyto }}</a>
			{{- else if .Params.rsvpValue -}}
			<h1 class="title p-name">üìÖ RSVP:<br> {{ .Params.rsvpEventName }}</h1>
			{{- else if .Params.mfquotationof -}}
			<h1 class="title">üí¨ Quote of:<br> {{ .Params.mfquotationof }}</h1>
			{{- else -}}
		   <h1 class="title p-name">LOLL SOMETHING WRONG..pLz ChECK! {{ .Title }}</h1>
		   {{- end -}}
		   <!-- indieweb: title OFF -->

			<div class="meta">Posted: {{ dateFormat "Jan 2, 2006" .Date }}{{ if .Draft }} <span class="draft-label">DRAFT</span> {{ end }} | Reading time: {{.ReadingTime}} min</div>

			<div style="display:none;">
			<time class="dt-published" datetime="{{ .Date.Format "2006-01-02 15:04:05 +0800" }}" ></time>
			<a class="u-url" href="{{ .Permalink }}" ></a>
			<a class="p-category">{{ .Params.webmentionType | default "post" }}</a>
			<a class="p-author h-card" >{{ .Params.author | default .Site.Author.name }}</a>
			<!-- webmention endpoint (auto publish) -->
			{{ if .Params.mfreplyto }}
			{{- $source := .Params.mfSource | lower -}}
				{{- if eq $source "twitter" -}}
				<a href="https://brid.gy/publish/twitter"></a>
				{{- else if eq $source "mastodon" -}}
				<a href="https://brid.gy/publish/mastodon"></a>
				{{- else if eq $source "github" -}}
				<a href="https://brid.gy/publish/github"></a>
				{{- else -}}
				<!-- nothing, pls check https://brid.gy/about#webmentions -->
				{{- end -}}
			{{- end -}}
			</div>

		</div>
		{{ if isset .Params "tldr" }}
		<div class="tldr p-summary">
			<strong>tl;dr:</strong>
			{{ .Params.tldr }}
		</div>{{ end }}

		{{ if .Params.mfreplyto }}
		{{- $source := .Params.mfSource | lower -}}
			{{- with .Params.mfreplyto -}}
				<h2>Origin:</h2>
				{{- if eq $source "twitter" -}}
					{{- $tweetId := replaceRE `https?:\/\/twitter.com\/[a-zA-Z0-9_]{1,20}\/status\/([0-9]*)` `$1` . -}}
					{{- $urlPre := "https://publish.twitter.com/oembed" -}}
					{{- $embedParams := "?cards=none&conversation=none&link_color=%23d40d0a&url=" -}}
					{{- $tweetReply := . -}}
					{{- $tweetJ := getJSON $urlPre $embedParams $tweetReply -}}
						{{- if $tweetJ.html -}}
								{{- $tweetJ.html | safeHTML -}}
						{{- end -}}
				{{- else if eq $source "mastodon" -}}
				{{- else if eq $source "github" -}}
					{{- $ghType := "issue" -}}
					{{- if in . "issuecomment" -}}
						{{- $ghType = "comment" -}}
						<p>New {{ $ghType }} on project <a href="{{ . }}">"{{ $.Params.mfGhProjectName }}"</a></p>
						{{ $json_issuecommentId := replaceRE `^https?:\/\/github.com\/[a-zA-Z0-9_]{1,20}\/[a-zA-Z0-9_]{1,20}\/pull\/[0-9]*#issuecomment-` `$1` . -}}
						{{ $json_issuecommentUrl := printf "https://api.github.com/repos/athul/archie/issues/comments/%s"  $json_issuecommentId  }}
						{{ $json_issuecommentResponse := getJSON $json_issuecommentUrl }}
						<blockquote>{{ $json_issuecommentResponse.body | safeHTML }}
							<br /><p>&mdash; {{ $json_issuecommentResponse.user.login }} (<a href="{{ $json_issuecommentResponse.url }}">{{ dateFormat "January 2, 2006" $json_issuecommentResponse.updated_at }})</a></p>
						</blockquote>
					{{- else -}}
					<p>New {{ $ghType }} on project <a href="{{ . }}">"{{ $.Params.mfGhProjectName }}"</a></p>
					{{- end -}}
				{{- else -}}
				{{ end }}
				<h2>My reply:</h2>
			{{ end }}
		{{ end }}

		<section class="body">
			{{ if .Params.rsvpEventName }}
				RSVP <code><span class="p-rsvp">{{ .Params.rsvpValue }}</span></code> to <a href="{{ .Params.rsvpUrl }}" class="u-in-reply-to">{{ .Params.rsvpEventName }}</a>
			{{ end }}

			<div class="e-content">
				{{ .Content }}
				{{ if .Params.mfquotationof }}
				{{- $source := .Params.mfSource | lower -}}
				<cite class="u-quotation-of h-cite" style="display:none;">
					Quoted <a href="{{ .Params.mfquotationof }}">this</a>:
				</cite>
					{{- if ne $source "twitter" -}}
					<blockquote>
					TEXT TEXT
					</blockquote>
					{{ end }}
				{{ end }}
			</div>
			{{ if .Params.mfquotationof }}
			{{- $source := .Params.mfSource | lower -}}
			{{- if eq $source "twitter" -}}
				{{- $tweetId := replaceRE `https?:\/\/twitter.com\/[a-zA-Z0-9_]{1,20}\/status\/([0-9]*)` `$1` .Params.mfquotationof -}}
				{{- $url := printf "https://api.twitter.com/1/statuses/oembed.json?id=%v&dnt=%v&theme=dark&omit_script=true"  $tweetId  "true" -}}
				{{- $json := getJSON $url -}}
				{{ $json.html | safeHTML }}
			{{ end }}
			{{ end }}
		</section>

		{{ with .Params.syndication }}
		<br><small class="text-center">üîÄ Syndicated to:</small>
		{{ $syndication_len := len . }}
		{{ range $i, $syndication_item := . }}
			{{ if ne . "" }}
				{{ $domain := replaceRE "^https?://([^/]+).*" "$1" . }}
					{{- if in $domain "twitter.com" -}}
						<a href="{{ $syndication_item }}" target="_blank" rel="nofollow noopener noreferrer syndication" class="u-syndication" title="{{ $domain }}"><i class="icon" icon-name="twitter"></i></a>
					{{- else if in $domain "github.com" -}}
						<a href="{{ $syndication_item }}" target="_blank" rel="nofollow noopener noreferrer syndication" class="u-syndication" title="{{ $domain }}"><i class="icon" icon-name="github"></i></a>
					{{ else }}
						<a href="{{ $syndication_item }}" target="_blank" rel="nofollow noopener noreferrer syndication" class="u-syndication" title="{{ $domain }}"><i class="icon" icon-name="network"></i></a>
					{{ end }}
					{{ if ne (add $i 1) $syndication_len }}<span>/</span>{{ end }}
			{{ end}}
		{{ end }}
		{{ end }}

		<p style="text-align: right; font-size: x-small;">
			<a href="{{ $.Site.Params.Repository }}blob/master/content/{{.File.Path}}">Edit</a>
		</p>

		{{ if ne .Type "page" }}
		{{ if gt .Params.tags 0 }}
		<div class="post-tags">
			<nav class="nav tags">
				<ul class="tags">
					{{ range .Params.tags }}
					<li><a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}">{{ . }}</a></li>
					{{ end }}
				</ul>
			</nav>
		</div>
		{{ end }}
		{{ end }}
		{{- if and ( .Params.comments | default true ) ( .Site.Params.enableComments | default false) -}}
		<div id="comment">
			{{ partial "disqus.html" . }}
		</div>
		{{ end }}
		{{ partial "next-prev-post.html" . }}
	</article>
</main>
{{ end }}
